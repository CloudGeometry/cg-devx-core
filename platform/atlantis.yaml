version: 3
automerge: true
projects:
  - dir: terraform/hosting_provider
    terraform_version: 1.3.9
    autoplan:
      enabled: true
      when_modified: [ "**/*.tf", "../modules/cloud_*/**/*.tf", "*.tf*" ]
      execution_order_group: 2
  - dir: terraform/vcs
    terraform_version: 1.3.9
    autoplan:
      enabled: true
      when_modified: [ "**/*.tf", "../modules/vcs_*/**/*.tf", "*.tf*" ]
      execution_order_group: 1
#      extra_args: ["-var-file", "../workloads.tfvars"]
  - dir: terraform/users
    terraform_version: 1.3.9
    autoplan:
      enabled: true
      when_modified: [ "**/*.tf", "../modules/users_*/**/*.tf", "*.tf*" ]
      execution_order_group: 4
#      extra_args: ["-var-file", "../workloads.tfvars"]
  - dir: terraform/secrets
    terraform_version: 1.3.9
    autoplan:
      enabled: true
      when_modified: [ "**/*.tf", "../modules/secrets_*/**/*.tf", "*.tf*", "../workloads.tfvars" ]
      execution_order_group: 3
      extra_args: ["-var-file", "../workloads.tfvars"]
  - dir: terraform/artifact_registry
    terraform_version: 1.3.9
    autoplan:
      enabled: true
      when_modified: [ "**/*.tf", "../modules/artifact_*/**/*.tf", "*.tf*", "../workloads.tfvars" ]
      execution_order_group: 5
      extra_args: ["-var-file", "../workloads.tfvars"]
