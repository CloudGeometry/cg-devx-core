# Templating

This section describes the platform reference implementation templating process.

All the readme files prefixed with `tpl_` will be parametrized and added to the user's GitOps repository.

All the values in files templated with - `<key>` under
`/platform` folder will be replaced with corresponding values generated by the system during the setup process.
In terraform files (`*.tf`) sections to be templated are also prefixed with comment symbol (`#`),
e.g. `# <key>` for integrity.

## Input values placeholder reference

Templating variables reference to input parameters

- `CLOUD_PROVIDER` - Cloud provider type
- `CLOUD_REGION` - Cloud region, replaced by cloud provider default when not specified
- `PRIMARY_CLUSTER_NAME` - Primary K8s cluster name
- `DOMAIN_NAME` - Domain name used for the deployment
- `OWNER_EMAIL` - Deployment owner URL, used for alerting
- `GIT_ORGANIZATION_NAME` - Git Organisation name
- `GIT_PROVIDER` - Git provider type
- `GITOPS_REPOSITORY_NAME` - Platform GitOps repository name

## Generated

Templating variables generated during setup process

### IAM roles

IAM roles for core components created during the setup process

- `CERT_MANAGER_IAM_ROLE_RN` - Certificate Manager IAM role for a K8s service account
- `CI_IAM_ROLE_RN` - Continuous Integration (Argo Workflow / Git* runners) IAM role for K8s service account
- `EXTERNAL_DNS_IAM_ROLE_RN` - External DNS IAM role for a K8s service account
- `IAC_PR_AUTOMATION_IAM_ROLE_RN` - IaC PR automation IAM role for a K8s service account
- `SECRET_MANAGER_IAM_ROLE_RN` - Secrets Manager (Vault) IAM role for a K8s service account

### Ingress

Ingress URLs for core components. Note!: URL does not contain protocol prefix

- `CC_CLUSTER_FQDN` - Primary K8s cluster FQDN
- `CD_INGRESS_URL` - Continuous Delivery (ArgoCD) ingress URL
- `CI_INGRESS_URL` - Continuous Integration (Argo Workflow) ingress URL
- `GRAFANA_INGRESS_URL` - Metrics / Logs visualization system (Grafana) ingress URL
- `IAC_PR_AUTOMATION_INGRESS_URL` - IaC PR automation (Atlantis) ingress URL
- `REGISTRY_INGRESS_URL` - Registry (Harbor) ingress URL
- `REGISTRY_REGISTRY_URL` - Registry (Harbor) entrypoint
- `SECRET_MANAGER_INGRESS_URL` - Secrets Manager (Vault) ingress URL
- `CODE_QUALITY_INGRESS_URL` - Code Quality (SonarQube) ingress URL

### Git

- `GIT_REPOSITORY_GIT_URL` - Platform GitOps repository Git URL
- `GIT_REPOSITORY_ROOT` - Git organisation root
- `GIT_REPOSITORY_URL` - Platform GitOps repository Http URL
- `GIT_USER_NAME` - Git machine user name used by Platform
- `GIT_USER_LOGIN` - Git machine user login used by Platform
- `IAC_PR_AUTOMATION_WEBHOOK_SECRET` - IaC PR automation (Atlantis) webhook secret
- `IAC_PR_AUTOMATION_WEBHOOK_URL` - IaC PR automation (Atlantis) webhook
- `VCS_BOT_SSH_PUBLIC_KEY` - Git machine user SSH public key

### OIDC

OIDC provider configuration Note!: URL does not contain protocol prefix

- `OIDC_PROVIDER_AUTHORIZE_URL` OIDC provider (Vault) authorise URL
- `OIDC_PROVIDER_TOKEN_URL` - OIDC provider (Vault) token URL
- `OIDC_PROVIDER_URL` - OIDC provider (Vault) URL
- `OIDC_PROVIDER_USERINFO_URL` - OIDC provider (Vault) user info URL

- `CD_OAUTH_CALLBACK_URL` - Continuous Delivery (ArgoCD) OAuth callback URL
- `CI_OAUTH_CALLBACK_URL` - Continuous Integration (Argo Workflow) OAuth callback URL

### K8s

- `CC_CLUSTER_SSH_PUBLIC_KEY` Primary K8s cluster SSH public key
- `K8S_ROLE_MAPPING` - K8s service account IAM role mapping attribute, cloud provider specific
- `KUBECTL_VERSION` - kubectl version

### Terraform snippets

- `GIT_PROVIDER_MODULE` - Terraform Git provider definition
- `TF_HOSTING_PROVIDER` - Terraform Cloud provider definition, eg AWS, Azure, GCP
- `TF_HOSTING_REMOTE_BACKEND` - Terraform state storage backend definition for cloud infrastructure, cloud provider
  specific
- `TF_SECRETS_REMOTE_BACKEND`- Terraform state storage backend definition for secrets, cloud provider specific
- `TF_USERS_REMOTE_BACKEND` - Terraform state storage backend definition for users, cloud provider specific
- `TF_VCS_REMOTE_BACKEND`- Terraform state storage backend definition for version control (Git), cloud provider specific

### Manifest snippets

- `SECRET_MANAGER_SEAL` - Secret Manager (Vault) seal configuration

### Cloud

- `CLOUD_ACCOUNT` - Cloud account number, e.g., AWS account number, cloud provider specific
- `CLOUD_BINARY_ARTIFACTS_STORE` - Continuous Integration (Argo Workflow) Artifact Repository, cloud provider specific
- `NETWORK_ID` - Platform primary K8s cluster network ID
- `SECRET_MANAGER_SEAL_RN` - Secrets Manager (Vault) seal key ID

## Internal params

- `ARGOCD_PASSWORD` - Continuous Delivery (ArgoCD) admin password
- `ARGOCD_TOKEN` - Continuous Delivery (ArgoCD) admin token
- `ARGOCD_USER` - Continuous Delivery (ArgoCD) admin username
- `CC_CLUSTER_CA_CERT_DATA` - K8s cluster Certificate Authority certificate data
- `CC_CLUSTER_CA_CERT_PATH` - K8s cluster Certificate Authority certificate path
- `CC_CLUSTER_ENDPOINT` - Primary K8s cluster admin API endpoint
- `CLUSTER_SSH_PRIVATE_KEY` - K8s cluster SSH private key
- `CLUSTER_SSH_PRIVATE_KEY_PATH` - K8s cluster SSH private key path
- `CLUSTER_SSH_PUBLIC_KEY_PATH` - K8s cluster SSH public key path
- `DEFAULT_SSH_PRIVATE_KEY` - Default platform SSH private key
- `DEFAULT_SSH_PRIVATE_KEY_PATH` - Default platform SSH private key path
- `DEFAULT_SSH_PUBLIC_KEY` - Default platform SSH public key
- `DEFAULT_SSH_PUBLIC_KEY_PATH` - Default platform SSH public key path
- `GIT_ACCESS_TOKEN` - Git access token
- `GIT_USER_EMAIL` - Git machine user email
- `GIT_USER_LOGIN` - Git machine user login
- `GIT_USER_NAME` - Git machine user name
- `KCTL_CONFIG_PATH` - Primary K8s cluster kubectl config path
- `REGISTRY_ROBO_USER` - Registry (Harbor) machine username
- `REGISTRY_ROBO_USER_AUTH` - Registry (Harbor) auth string
- `REGISTRY_ROBO_USER_PASSWORD` - Registry (Harbor) machine user password
- `TF_BACKEND_STORAGE_NAME` - Terraform state storage backend location
- `VAULT_ROOT_TOKEN` - Secrets Manager (Vault) root access token